name: Test
on: 
  - push
  - pull_request
env:
  CARGO_TERM_COLOR: always
jobs:
  test:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2

    # TODO: Add cargo caching

    - name: Install Rust
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly-2021-03-04
        override: true
        components: rustfmt, clippy
    - name: Install apertium-all-dev
      run: wget http://apertium.projectjj.com/apt/install-nightly.sh -O - | sudo bash
    - name: Install other language tools
      run: sudo apt-get install cg3 lexd

    - uses: actions-rs/install@v0.1
      with:
        crate: diesel_cli
        version: '1.4.1'
    - uses: actions-rs/install@v0.1
      with:
        crate: cargo-tarpaulin
        version: '0.16.0'

    - name: Check formatting
      uses: actions-rs/cargo@v1
      with:
        command: fmt
        args: -- --check
    # TODO: Switch to using https://github.com/actions-rs/clippy-check
    - name: Check lints
      uses: actions-rs/cargo@v1
      with:
        command: clippy
        args: --all-targets --all-features -- -D warnings
    # TODO: Run tests
    # TODO: Run coverage
